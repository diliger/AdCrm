var IE6 = (navigator.userAgent.indexOf("MSIE 6") >= 0) ? true : false;
var IE7 = (navigator.userAgent.indexOf("MSIE 7") >= 0) ? true : false;
//var iPad = (navigator.userAgent.indexOf("iPad") >= 0) ? true : false;
var iPhone = (navigator.userAgent.indexOf("iPhone") >= 0) ? true : false;
var Android = (navigator.userAgent.indexOf("Android") >= 0) ? true : false;

z = {};
z.userSettings = function (value) {
    if (typeof value != "undefined" && typeof value != "function") {
        localStorage.userSettings = JSON.stringify(value);
        return value;
    }

    var settings = {};

    if (localStorage.userSettings) {
        try {
            settings = eval("(" + localStorage.userSettings + ")");
        } catch (ex) {
            settings = {};
        }
    }

    if (typeof value == "function") {
        z.userSettings(value(settings));
    }

    return settings;
};
z.filter = {};
z.filter.parseKeywords = function (keywords) {
    var keywordsArray = [];
    var separate = true;
    var keyword = "";

    for (var i = 0; i < keywords.length; i++) {
        if ((keywords.charAt(i) == " " && separate) || (keywords.charAt(i) == '"' && !separate)) {
            if (keyword) {
                keywordsArray.push(keyword.toLowerCase());
                keyword = "";
            }
            separate = true;
        } else if (keywords.charAt(i) == '"') {
            separate = false;
        } else {
            keyword += keywords.charAt(i);
        }
    }

    if (keyword) {
        keywordsArray.push(keyword.toLowerCase());
    }

    return keywordsArray;
};
z.filter.toRegExp = function (keywords) {
    return new RegExp(z.filter.parseKeywords(keywords).select("val=>RegExp.escape(val)").join("|"), "gi");
};
z.filter.markMatches = function (value, keywords) {
    if (!keywords) {
        return value;
    }

    return value.replace(z.filter.toRegExp(keywords), "<span class='filterResult'>$&</span>");
};

window.showTip = function showTip(content, element, css) {
    css = css || "";
    var div = $(".event-alert");
    if (!div.length) {
        div = $("<div class='event-alert'></div>");
        $("body").append(div);
    }
    div.html(content);
    div.attr("class", "event-alert " + css);
    var top, left;

    if (element) {
        element = $(element);
        top = element.offset().top - div.outerHeight();
        left = element.offset().left;
    } else {
        top = window.scrollY + 100;
        left = window.outerWidth - div.outerWidth() - 100;
    }
    div.css("top", top);
    div.css("left", left);
    div.fadeOut(css == "error" ? 5000 : 2500, function () {
        div.css("top", -1000);
        div.css("left", -1000);
        div.show();
    });
};

$(function () {
    if (window.host && host.onLoad) {
        if (typeof host.onLoad == "function") {
            host.onLoad();
        } else if (Array.isArray(host.onLoad)) {
            for (var i = 0; i < host.onLoad.length; i++) {
                if (typeof host.onLoad[i] == "function") {
                    host.onLoad[i]();
                }
            }
        }
    }
});